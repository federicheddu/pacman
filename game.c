#include "game.h"

/* --- STAMPA DEL MENU --- */

//gestione del menu
int mainMenu() {
    int menu = 0;
    char selMenu;

    do {

        switch(menu) {
            case NEWGAME:
                printNewGame();
                break;
            case EXIT:
                printExit();
                break;
            case SUGA:
                printSUGA();
                break;
        }

        selMenu = getch();
        switch (selMenu) {
            case GIU:
                menu++;
                break;
            case SU:
                menu--;
                break;
        }
        menu = menu%3;

    } while(selMenu != '\n');
    return menu;
}

//stampa della schermata Nuova Partita
void printNewGame() {

    char newGame[60][152] = {"##==================================================================================================================================================##\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                    =       ======  =======     ==============  =====  =====  =====  =======  =                                   ||\n",
                             "||                                    =  ====  ====    =====  ===  =============   ===   ====    ====   ======  =                                   ||\n",
                             "||                                    =  ====  ===  ==  ===  ===================  =   =  ===  ==  ===    =====  =                                   ||\n",
                             "||                                    =  ====  ==  ====  ==  ===================  == ==  ==  ====  ==  ==  ===  =                                   ||\n",
                             "||                                    =       ===  ====  ==  ========         ==  =====  ==  ====  ==  ===  ==  =                                   ||\n",
                             "||                                    =  ========        ==  ===================  =====  ==        ==  ====  =  =                                   ||\n",
                             "||                                    =  ========  ====  ==  ===================  =====  ==  ====  ==  =====    =                                   ||\n",
                             "||                                    =  ========  ====  ===  ===  =============  =====  ==  ====  ==  ======   =                                   ||\n",
                             "||                                    =  ========  ====  ====     ==============  =====  ==  ====  ==  =======  =                                   ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                                || NUOVA  PARTITA ||                                                              ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                        ESCI                                                                      ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                        SUGA                                                                      ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "##==================================================================================================================================================##"};

    attron(COLOR_PAIR(1));
    for(int i=0; i<=49; i++)
        mvprintw(i, 0, "%s", newGame[i]);

}

//stampa della schermata Esci
void printExit() {

    char newGame[60][152] = {"##==================================================================================================================================================##\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                    =       ======  =======     ==============  =====  =====  =====  =======  =                                   ||\n",
                             "||                                    =  ====  ====    =====  ===  =============   ===   ====    ====   ======  =                                   ||\n",
                             "||                                    =  ====  ===  ==  ===  ===================  =   =  ===  ==  ===    =====  =                                   ||\n",
                             "||                                    =  ====  ==  ====  ==  ===================  == ==  ==  ====  ==  ==  ===  =                                   ||\n",
                             "||                                    =       ===  ====  ==  ========         ==  =====  ==  ====  ==  ===  ==  =                                   ||\n",
                             "||                                    =  ========        ==  ===================  =====  ==        ==  ====  =  =                                   ||\n",
                             "||                                    =  ========  ====  ==  ===================  =====  ==  ====  ==  =====    =                                   ||\n",
                             "||                                    =  ========  ====  ===  ===  =============  =====  ==  ====  ==  ======   =                                   ||\n",
                             "||                                    =  ========  ====  ====     ==============  =====  ==  ====  ==  =======  =                                   ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                   NUOVA  PARTITA                                                                 ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                                ||      ESCI      ||                                                              ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                        SUGA                                                                      ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "##==================================================================================================================================================##"};

    attron(COLOR_PAIR(1));
    for(int i=0; i<=49; i++)
        mvprintw(i, 0, "%s", newGame[i]);

}

//Stampa della schermata Selezione Progetto
void printSUGA() {

    char newGame[60][152] = {"##==================================================================================================================================================##\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                    =       ======  =======     ==============  =====  =====  =====  =======  =                                   ||\n",
                             "||                                    =  ====  ====    =====  ===  =============   ===   ====    ====   ======  =                                   ||\n",
                             "||                                    =  ====  ===  ==  ===  ===================  =   =  ===  ==  ===    =====  =                                   ||\n",
                             "||                                    =  ====  ==  ====  ==  ===================  == ==  ==  ====  ==  ==  ===  =                                   ||\n",
                             "||                                    =       ===  ====  ==  ========         ==  =====  ==  ====  ==  ===  ==  =                                   ||\n",
                             "||                                    =  ========        ==  ===================  =====  ==        ==  ====  =  =                                   ||\n",
                             "||                                    =  ========  ====  ==  ===================  =====  ==  ====  ==  =====    =                                   ||\n",
                             "||                                    =  ========  ====  ===  ===  =============  =====  ==  ====  ==  ======   =                                   ||\n",
                             "||                                    =  ========  ====  ====     ==============  =====  ==  ====  ==  =======  =                                   ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                   NUOVA  PARTITA                                                                 ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                        ESCI                                                                      ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                                ||      SUGA      ||                                                              ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                              super user general access                                                           ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "##==================================================================================================================================================##"};

    attron(COLOR_PAIR(1));
    for(int i=0; i<=49; i++)
        mvprintw(i, 0, "%s", newGame[i]);

}


/* --- STAMPA DEL GIOCO --- */

//stampa del gioco
void printCampo(int level){
  char Campo[60][152]={"##==================================================================================================================================================##\n",
                       "||                                                                                                                                                  ||\n",
                       "||                                      #######################################################################                                     ||\n",
                       "||                                      #                              #########                              #                                     ||\n",
                       "||                                      # .  .  .  .   .  .  .  . .  . ######### .  . .  .  .  .   .  .  .  . #                                     ||\n",
                       "||         LEVEL:                       #                              #########                              #             LIVEs:                  ||\n",
                       "||         SCORE:                       #   ##########   ###########   #########   ###########   ##########   #             TIME:                   ||\n",
                       "||                                      # . ########## . ########### . ######### . ########### . ########## . #             FRUITs:                 ||\n",
                       "||                                      #   ##########   ###########   #########   ###########   ##########   #             KILLs:                  ||\n",
                       "||                                      #   ##########   ###########   #########   ###########   ##########   #                                     ||\n",
                       "||         HIGHSCORES:                  # . ########## . ########### . ######### . ########### . ########## . #                                     ||\n",
                       "||         1.                           #   ##########   ###########   #########   ###########   ##########   #                                     ||\n",
                       "||         2.                           #                                                                     #                                     ||\n",
                       "||         3.                           # .  .  .  .   .  .  .  . .  .  .  .  .  .  . .  .  .  .   .  .  .  . #                                     ||\n",
                       "||                                      #                                                                     #                                     ||\n",
                       "||                                      #   ##########   ######   ###################   ######   ##########   #                                     ||\n",
                       "||                                      # . ########## . ###### . ################### . ###### . ########## . #                                     ||\n",
                       "||                                      #   ##########   ######   ###################   ######   ##########   #                                     ||\n",
                       "||                                      #                ######        #########        ######                #                                     ||\n",
                       "||                                      # .  .  .   .  . ###### .    . ######### .    . ###### .  .   .  .  . #                                     ||\n",
                       "||                                      #                ######        #########        ######                #                                     ||\n",
                       "||                                      ##############   ###########   #########   ###########   ##############                                     ||\n",
                       "||                                      ############## . ########### . ######### . ########### . ##############                                     ||\n",
                       "||                                      ##############   ###########   #########   ###########   ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ############## . ###### .  .  .  .   .  .  .  . ###### . ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ##############   ######   #######+   +#######   ######   ##############                                     ||\n",
                       "||                                      ############## . ###### . #                 # . ###### . ##############                                     ||\n",
                       "||                                                                +                 +                                                               ||\n",
                       "||                                                     .  .  .  .                     .  .  .  .                                                    ||\n",
                       "||                                                                +                 +                                                               ||\n",
                       "||                                      ############## . ###### . #                 # . ###### . ##############                                     ||\n",
                       "||                                      ##############   ######   #######+   +#######   ######   ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ############## . ###### .  .  .  .   .  .  .  . ###### . ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ##############   ######   ###################   ######   ##############                                     ||\n",
                       "||                                      #                               #######                               #                                     ||\n",
                       "||                                      # .  .  .  .   .  .  .  .  .  . ####### .  .  .  .  .  .   .  .  .  . #                                     ||\n",
                       "||                                      #                               #######                               #                                     ||\n",
                       "||                                      #   ##########   ############   #######   ############   ##########   #                                     ||\n",
                       "||                                      # . ########## . ############ . ####### . ############ . ########## . #                                     ||\n",
                       "||                                      #   ##########   ############   #######   ############   ##########   #                                     ||\n",
                       "||                                      #          ###                                           ###          #                                     ||\n",
                       "||                                      # .  .   . ### .  .  .  .  .  .  .   .  .  .  .  .  .  . ### .   .  . #                                     ||\n",
                       "||                                      #          ###                                           ###          #                                     ||\n",
                       "||                                      ########   ###   ######   ###################   ######   ###   ########                                     ||\n",
                       "||                                      ######## . ### . ###### . ################### . ###### . ### . ########                                     ||\n",
                       "||                                      ########   ###   ######   ###################   ######   ###   ########                                     ||\n",
                       "||                                      #                ######         #######         ######                #                                     ||\n",
                       "||                                      # .  .  .   .  . ###### .  .  . ####### .  .  . ###### .  .   .  .  . #                                     ||\n",
                       "||                                      #                ######         #######         ######                #                                     ||\n",
                       "||                                      # . ######################### . ####### . ######################### . #                                     ||\n",
                       "||                                      #                                                                     #                                     ||\n",
                       "||                                      # .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . #                                     ||\n",
                       "||                                      #                                                                     #                                     ||\n",
                       "||                                      #######################################################################                                     ||\n",
                       "||                                                                                                                                                  ||\n",
                       "##==================================================================================================================================================##"};

    attron(COLOR_PAIR(1));
    for (int i=0; i<=59; i++)
        mvprintw(i,0,"%s", Campo[i]);
}

void printEntity(Pos entita, pthread_mutex_t *mutex) {

    pthread_mutex_lock(mutex);

    switch (entita.entita) {
        case BULLET:
            break;
        case PACMAN:
            mvaddch(entita.x,entita.y,'@');
            break;
        case BLINKY:
            break;
        case PINKY:
            break;
        case SPUNKY:
            break;
        case CLYDE:
            break;
        case INKY:
            break;
        case SUE:
            break;
        case FUNKY:
            break;
        case GLITCHY:
            break;
    }

    refresh();
    pthread_mutex_unlock(mutex);
}

void clearEntity(Pos entita, pthread_mutex_t *mutex) {

    pthread_mutex_lock(mutex);

    switch(entita.dir) {
      case SU:
        mvaddch(entita.x,entita.y+1,' ');
        break;

      case GIU:
        mvaddch(entita.x,entita.y-1,' ');
        break;

      case SINISTRA:
        mvaddch(entita.x+1,entita.y,' ');
        break;

      case DESTRA:
        mvaddch(entita.x-1,entita.y,' ');
        break;
    }

    refresh();
    pthread_mutex_unlock(mutex);
}

//stampa delle statistiche della partita
void gameController(int livello, Buffer *buffer){
    int vite = 3;
    int colpiSubiti = 0;
    Pos entita;
    BufferElement *node;

    printCampo(livello);
    refresh();

    while(vite > 0) {
        
        node = removeBuffer(buffer, mutex, NULL, 0);

        if(node != NULL) {
            entita = *(node->posizione);
            clearEntity(entita, mutex);
            printEntity(entita, mutex);
            mvaddch(15,200,'K');
        }
        
        refresh();
    }
}