#include "game.h"

/* --- STAMPA DEL MENU --- */

//gestione del menu
int mainMenu() {
    int menu = 0;
    char selMenu;

    do {

        switch(menu) {
            case NEWGAME:
                printNewGame();
                break;
            case EXIT:
                printExit();
                break;
            case SUGA:
                printSUGA();
                break;
        }

        selMenu = getch();
        switch (selMenu) {
            case GIU:
                menu++;
                break;
            case SU:
                menu--;
                break;
        }
        menu = menu%3;

    } while(selMenu != '\n');
    return menu;
}

//stampa della schermata Nuova Partita
void printNewGame() {

    char newGame[60][152] = {"##==================================================================================================================================================##\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                    =       ======  =======     ==============  =====  =====  =====  =======  =                                   ||\n",
                             "||                                    =  ====  ====    =====  ===  =============   ===   ====    ====   ======  =                                   ||\n",
                             "||                                    =  ====  ===  ==  ===  ===================  =   =  ===  ==  ===    =====  =                                   ||\n",
                             "||                                    =  ====  ==  ====  ==  ===================  == ==  ==  ====  ==  ==  ===  =                                   ||\n",
                             "||                                    =       ===  ====  ==  ========         ==  =====  ==  ====  ==  ===  ==  =                                   ||\n",
                             "||                                    =  ========        ==  ===================  =====  ==        ==  ====  =  =                                   ||\n",
                             "||                                    =  ========  ====  ==  ===================  =====  ==  ====  ==  =====    =                                   ||\n",
                             "||                                    =  ========  ====  ===  ===  =============  =====  ==  ====  ==  ======   =                                   ||\n",
                             "||                                    =  ========  ====  ====     ==============  =====  ==  ====  ==  =======  =                                   ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                                || NUOVA  PARTITA ||                                                              ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                        ESCI                                                                      ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                        SUGA                                                                      ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "##==================================================================================================================================================##"};

    attron(COLOR_PAIR(1));
    for(int i=0; i<=49; i++)
        mvprintw(i, 0, "%s", newGame[i]);

}

//stampa della schermata Esci
void printExit() {

    char newGame[60][152] = {"##==================================================================================================================================================##\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                    =       ======  =======     ==============  =====  =====  =====  =======  =                                   ||\n",
                             "||                                    =  ====  ====    =====  ===  =============   ===   ====    ====   ======  =                                   ||\n",
                             "||                                    =  ====  ===  ==  ===  ===================  =   =  ===  ==  ===    =====  =                                   ||\n",
                             "||                                    =  ====  ==  ====  ==  ===================  == ==  ==  ====  ==  ==  ===  =                                   ||\n",
                             "||                                    =       ===  ====  ==  ========         ==  =====  ==  ====  ==  ===  ==  =                                   ||\n",
                             "||                                    =  ========        ==  ===================  =====  ==        ==  ====  =  =                                   ||\n",
                             "||                                    =  ========  ====  ==  ===================  =====  ==  ====  ==  =====    =                                   ||\n",
                             "||                                    =  ========  ====  ===  ===  =============  =====  ==  ====  ==  ======   =                                   ||\n",
                             "||                                    =  ========  ====  ====     ==============  =====  ==  ====  ==  =======  =                                   ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                   NUOVA  PARTITA                                                                 ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                                ||      ESCI      ||                                                              ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                        SUGA                                                                      ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "##==================================================================================================================================================##"};

    attron(COLOR_PAIR(1));
    for(int i=0; i<=49; i++)
        mvprintw(i, 0, "%s", newGame[i]);

}

//Stampa della schermata Selezione Progetto
void printSUGA() {

    char newGame[60][152] = {"##==================================================================================================================================================##\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                    =       ======  =======     ==============  =====  =====  =====  =======  =                                   ||\n",
                             "||                                    =  ====  ====    =====  ===  =============   ===   ====    ====   ======  =                                   ||\n",
                             "||                                    =  ====  ===  ==  ===  ===================  =   =  ===  ==  ===    =====  =                                   ||\n",
                             "||                                    =  ====  ==  ====  ==  ===================  == ==  ==  ====  ==  ==  ===  =                                   ||\n",
                             "||                                    =       ===  ====  ==  ========         ==  =====  ==  ====  ==  ===  ==  =                                   ||\n",
                             "||                                    =  ========        ==  ===================  =====  ==        ==  ====  =  =                                   ||\n",
                             "||                                    =  ========  ====  ==  ===================  =====  ==  ====  ==  =====    =                                   ||\n",
                             "||                                    =  ========  ====  ===  ===  =============  =====  ==  ====  ==  ======   =                                   ||\n",
                             "||                                    =  ========  ====  ====     ==============  =====  ==  ====  ==  =======  =                                   ||\n",
                             "||                                    ===========================================================================                                   ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                   NUOVA  PARTITA                                                                 ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                        ESCI                                                                      ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                                ||      SUGA      ||                                                              ||\n",
                             "||                                                                ##================##                                                              ||\n",
                             "||                                                              super user general access                                                           ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "||                                                                                                                                                  ||\n",
                             "##==================================================================================================================================================##"};

    attron(COLOR_PAIR(1));
    for(int i=0; i<=49; i++)
        mvprintw(i, 0, "%s", newGame[i]);

}


/* --- STAMPA DEL GIOCO --- */

//stampa del gioco
void printCampo(int level){
  char Campo[60][152]={"##==================================================================================================================================================##\n",
                       "||                                                                                                                                                  ||\n",
                       "||                                      #######################################################################                                     ||\n",
                       "||                                      #                              #########                              #                                     ||\n",
                       "||                                      # .  .  .  .   .  .  .  . .  . ######### .  . .  .  .  .   .  .  .  . #                                     ||\n",
                       "||         LEVEL:                       #                              #########                              #             LIVEs:                  ||\n",
                       "||         SCORE:                       #   ##########   ###########   #########   ###########   ##########   #             TIME:                   ||\n",
                       "||                                      # . ########## . ########### . ######### . ########### . ########## . #             FRUITs:                 ||\n",
                       "||                                      #   ##########   ###########   #########   ###########   ##########   #             KILLs:                  ||\n",
                       "||                                      #   ##########   ###########   #########   ###########   ##########   #                                     ||\n",
                       "||         HIGHSCORES:                  # . ########## . ########### . ######### . ########### . ########## . #                                     ||\n",
                       "||         1.                           #   ##########   ###########   #########   ###########   ##########   #                                     ||\n",
                       "||         2.                           #                                                                     #                                     ||\n",
                       "||         3.                           # .  .  .  .   .  .  .  . .  .  .  .  .  .  . .  .  .  .   .  .  .  . #                                     ||\n",
                       "||                                      #                                                                     #                                     ||\n",
                       "||                                      #   ##########   ######   ###################   ######   ##########   #                                     ||\n",
                       "||                                      # . ########## . ###### . ################### . ###### . ########## . #                                     ||\n",
                       "||                                      #   ##########   ######   ###################   ######   ##########   #                                     ||\n",
                       "||                                      #                ######        #########        ######                #                                     ||\n",
                       "||                                      # .  .  .   .  . ###### .    . ######### .    . ###### .  .   .  .  . #                                     ||\n",
                       "||                                      #                ######        #########        ######                #                                     ||\n",
                       "||                                      ##############   ###########   #########   ###########   ##############                                     ||\n",
                       "||                                      ############## . ########### . ######### . ########### . ##############                                     ||\n",
                       "||                                      ##############   ###########   #########   ###########   ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ############## . ###### .  .  .  .   .  .  .  . ###### . ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ##############   ######   #######+   +#######   ######   ##############                                     ||\n",
                       "||                                      ############## . ###### . #                 # . ###### . ##############                                     ||\n",
                       "||                                                                +                 +                                                               ||\n",
                       "||                                                     .  .  .  .                     .  .  .  .                                                    ||\n",
                       "||                                                                +                 +                                                               ||\n",
                       "||                                      ############## . ###### . #                 # . ###### . ##############                                     ||\n",
                       "||                                      ##############   ######   #######+   +#######   ######   ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ############## . ###### .  .  .  .   .  .  .  . ###### . ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ##############   ######   ###################   ######   ##############                                     ||\n",
                       "||                                      #                               #######                               #                                     ||\n",
                       "||                                      # .  .  .  .   .  .  .  .  .  . ####### .  .  .  .  .  .   .  .  .  . #                                     ||\n",
                       "||                                      #                               #######                               #                                     ||\n",
                       "||                                      #   ##########   ############   #######   ############   ##########   #                                     ||\n",
                       "||                                      # . ########## . ############ . ####### . ############ . ########## . #                                     ||\n",
                       "||                                      #   ##########   ############   #######   ############   ##########   #                                     ||\n",
                       "||                                      #          ###                                           ###          #                                     ||\n",
                       "||                                      # .  .   . ### .  .  .  .  .  .  .   .  .  .  .  .  .  . ### .   .  . #                                     ||\n",
                       "||                                      #          ###                                           ###          #                                     ||\n",
                       "||                                      ########   ###   ######   ###################   ######   ###   ########                                     ||\n",
                       "||                                      ######## . ### . ###### . ################### . ###### . ### . ########                                     ||\n",
                       "||                                      ########   ###   ######   ###################   ######   ###   ########                                     ||\n",
                       "||                                      #                ######         #######         ######                #                                     ||\n",
                       "||                                      # .  .  .   .  . ###### .  .  . ####### .  .  . ###### .  .   .  .  . #                                     ||\n",
                       "||                                      #                ######         #######         ######                #                                     ||\n",
                       "||                                      # . ######################### . ####### . ######################### . #                                     ||\n",
                       "||                                      #                                                                     #                                     ||\n",
                       "||                                      # .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . #                                     ||\n",
                       "||                                      #                                                                     #                                     ||\n",
                       "||                                      #######################################################################                                     ||\n",
                       "||                                                                                                                                                  ||\n",
                       "##==================================================================================================================================================##"};

    attron(COLOR_PAIR(1));
    for (int i=0; i<=59; i++)
        mvprintw(i,0,"%s", Campo[i]);
}

void printEntity(Pos entita, pthread_mutex_t *mutex) {

   pthread_mutex_lock(mutex);

    switch (entita.entita) {
        case PAC_BULLET:
            break;
        case GHOST_BULLET:
            break;
        case PACMAN:
            mvaddch(entita.y,entita.x,'@');
            break;
        case BLINKY:
            break;
        case PINKY:
            break;
        case CLYDE:
            break;
        case INKY:
            break;
        case FUNKY:
            break;
        case GLITCHY:
            break;
    }
  
    pthread_mutex_unlock(mutex);
    refresh();
}

void clearEntity(Pos entita, pthread_mutex_t *mutex) {

    pthread_mutex_lock(mutex);
    switch(entita.dir) {
      case SU:
        mvaddch(entita.y+1,entita.x,' ');
        break;

      case GIU:
        mvaddch(entita.y-1,entita.x,' ');
        break;

      case SINISTRA:
        mvaddch(entita.y,entita.x+1,' ');
        break;

      case DESTRA:
        mvaddch(entita.y,entita.x-1,' ');
        break;
    }

    
    pthread_mutex_unlock(mutex);
    refresh();
}

void startBullet(Pos** proiettili) {
    proiettili[PACMAN][SU - SHIFT_MOVIMENTO].entita = PAC_BULLET;
    proiettili[PACMAN][SU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[PACMAN][GIU - SHIFT_MOVIMENTO].entita = PAC_BULLET;
    proiettili[PACMAN][GIU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[PACMAN][DESTRA - SHIFT_MOVIMENTO].entita = PAC_BULLET;
    proiettili[PACMAN][DESTRA - SHIFT_MOVIMENTO].sparo = false;
    proiettili[PACMAN][SINISTRA - SHIFT_MOVIMENTO].entita = PAC_BULLET;
    proiettili[PACMAN][SINISTRA - SHIFT_MOVIMENTO].sparo = false;

    proiettili[BLINKY][SU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[BLINKY][SU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[BLINKY][GIU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[BLINKY][GIU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[BLINKY][DESTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[BLINKY][DESTRA - SHIFT_MOVIMENTO].sparo = false;
    proiettili[BLINKY][SINISTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[BLINKY][SINISTRA - SHIFT_MOVIMENTO].sparo = false;

    proiettili[PINKY][SU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[PINKY][SU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[PINKY][GIU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[PINKY][GIU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[PINKY][DESTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[PINKY][DESTRA - SHIFT_MOVIMENTO].sparo = false;
    proiettili[PINKY][SINISTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[PINKY][SINISTRA - SHIFT_MOVIMENTO].sparo = false;

    proiettili[CLYDE][SU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[CLYDE][SU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[CLYDE][GIU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[CLYDE][GIU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[CLYDE][DESTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[CLYDE][DESTRA - SHIFT_MOVIMENTO].sparo = false;
    proiettili[CLYDE][SINISTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[CLYDE][SINISTRA - SHIFT_MOVIMENTO].sparo = false;

    proiettili[INKY][SU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[INKY][SU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[INKY][GIU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[INKY][GIU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[INKY][DESTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[INKY][DESTRA - SHIFT_MOVIMENTO].sparo = false;
    proiettili[INKY][SINISTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[INKY][SINISTRA - SHIFT_MOVIMENTO].sparo = false;

    proiettili[FUNKY][SU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[FUNKY][SU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[FUNKY][GIU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[FUNKY][GIU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[FUNKY][DESTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[FUNKY][DESTRA - SHIFT_MOVIMENTO].sparo = false;
    proiettili[FUNKY][SINISTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[FUNKY][SINISTRA - SHIFT_MOVIMENTO].sparo = false;

    proiettili[GLITCHY][SU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[GLITCHY][SU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[GLITCHY][GIU - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[GLITCHY][GIU - SHIFT_MOVIMENTO].sparo = false;
    proiettili[GLITCHY][DESTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[GLITCHY][DESTRA - SHIFT_MOVIMENTO].sparo = false;
    proiettili[GLITCHY][SINISTRA - SHIFT_MOVIMENTO].entita = GHOST_BULLET;
    proiettili[GLITCHY][SINISTRA - SHIFT_MOVIMENTO].sparo = false;
}

//stampa delle statistiche della partita
void gameController(int livello, Buffer *buffer){
    int vite = 3;
    int colpiSubiti = 0;
    Pos entita;
    Par personaggi[NUM_PERSONAGGI];
    // Pos proiettili[NUM_PERSONAGGI][MAX_PROIETTILI];
    // startBullet(proiettili);
    BufferElement *node;

    usleep(500);
    printCampo(livello);
    refresh();

    while(personaggi[PACMAN].vite > 0) {
       
        node = removeBuffer(buffer);

        if(node != NULL) {
            entita = node->posizione;
            
            clearEntity(entita, mutexTerminale);
            printEntity(entita, mutexTerminale);

            //backup delle posizioni in locale
            if(entita.entita < NUM_PERSONAGGI)
                personaggi[entita.entita].posizione = entita;
            
            //se un entità ha sparato
           /* if(entita.entita < NUM_PERSONAGGI && entita.sparo) {
                for(int i=0; i<NUM_PERSONAGGI; i++) {
                    proiettili[entita.entita][i].x = entita.x;
                    proiettili[entita.entita][i].y = entita.y;
                }

                if(entita.entita == PACMAN) {               //se l'entità ad aver sparato è pacman
                    if(entityMv(entita.x, entita.y, SU))
                    if(entityMv(entita.x, entita.y, GIU))
                    if(entityMv(entita.x, entita.y, DESTRA))
                    if(entityMv(entita.x, entita.y, SINISTRA))
                } else {                                    //se l'entità ad aver sparato è un fantasma

                }

            }*/
           
        } 
    }
}