#ifndef PROJECT_UTILITY_H
#define PROJECT_UTILITY_H

#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <unistd.h>
#include <curses.h>
#include <pthread.h>
#include <time.h>

//macro sacra
#define DEBUG 0

//macro tasti, movimento e azioni
#define SU 65 						/* Freccia su */
#define GIU 66 						/* Freccia giu */
#define SINISTRA 68					/* Freccia sinsitra */
#define DESTRA 67					/* Freccia destra */
#define SPARO ' '                   /* Barra spaziatrice */
#define FERMO 0                     /* Entità si ferma */
#define SHIFT_MOVIMENTO 65

//macro menu
#define NEWGAME 0
#define EXIT 1
#define SUGA 2

//macro gioco
#define PASSO 1 					/* Spostamento entita */
#define NUM_PERSONAGGI 7            /* Pacman + fantasmi */
#define NUM_FANTASMI 4
#define MAX_FANTASMI 6
#define MAX_PROIETTILI 4            /* Numero massimo di proiettili in contemporanea per entità*/
#define NUM_PALLINI 210

typedef enum {
    PACMAN, BLINKY, PINKY, CLYDE, INKY, FUNKY, GLITCHY, BULLET
} Entity;

const static char EntityName[8][10] = {"PACMAN   ", "BLINKY    ", "PINKY    ", "CLYDE    ", "INKY     ", "FUNKY    ", "GLITCHY  ", "BULLET   "};

//definisce la posizione e il tipo di entita
typedef struct {
    int x;          //coordinata sul terminale
    int y;          //coordinata sul terminale
    int dir;        //direzione di movimento
    _Bool sparo;    //personaggio: se ha sparato || proiettile: se è attivo
    Entity entita;  //tipo di entità
    pthread_t id;   //id del thread
} Pos;


//definisce i parametri della pos
typedef struct {
    Pos posizione;
    int vite;           //numero di vite
    int colpiSubiti;    //numero di colpi di proiettile subiti
} Par;

//elemento della lista che andrà a comporre il buffer
typedef struct bufferElement {
    Pos posizione;
    struct bufferElement *next;
} BufferElement;

//definisce primo e ultimo elemento del buffer, tutte le operazioni in O(1)
typedef struct {
    BufferElement *first;
    BufferElement *last;
} Buffer;

//parametri di partenza per proiettili e fantasmi
typedef struct {
    Pos posizione;
    Buffer *buffer;
} PosStart;

//utility
int randRange(int min, int max);
_Bool entityMv(int x, int y, char dir);

//gestione del buffer
void insertBuffer(Buffer *buffer, pthread_mutex_t *mutex, Pos new);
BufferElement* removeBuffer(Buffer *buffer);
//stampe delle entità
void printEntity(Pos entita, pthread_mutex_t *mutex);
void clearEntity(Pos entita, pthread_mutex_t *mutex, int num, int pallini[][num]);

//mutex
static pthread_mutex_t mutexDatiAux = PTHREAD_MUTEX_INITIALIZER;
static pthread_mutex_t *mutexDati = &mutexDatiAux;
static pthread_mutex_t mutexTeminaleAux = PTHREAD_MUTEX_INITIALIZER;
static pthread_mutex_t *mutexTerminale = &mutexTeminaleAux;
static pthread_mutex_t mutexFantasmiAux = PTHREAD_MUTEX_INITIALIZER;
static pthread_mutex_t *mutexFantasmi = &mutexFantasmiAux;

//pallini
static int pallini[210][3] = {
        {4, 42, 0},{4, 45, 0},{4, 48, 0},{4, 51, 0},
        {4, 55, 0},{4, 58, 0},{4, 61, 0},{4, 64, 0},{4, 66, 0},{4, 69, 0},
        {4, 81, 0},{4, 84, 0},{4, 86, 0},{4, 89, 0},{4, 92, 0},{4, 95, 0},
        {4, 99, 0},{4, 102, 0},{4, 105, 0},{4, 108, 0},{7, 42, 0},{7, 55, 0},
        {7, 69, 0},{7, 81, 0},{7, 95, 0},{7, 108, 0},{10, 42, 0},{10, 55, 0},
        {10, 69, 0},{10, 81, 0},{10, 95, 0},{10, 108, 0},{13, 42, 0},{13, 45, 0},
        {13, 48, 0},{13, 51, 0},{13, 55, 0},{13, 58, 0},{13, 61, 0},{13, 64, 0},
        {13, 66, 0},{13, 69, 0},{13, 72, 0},{13, 75, 0},{13, 78, 0},{13, 81, 0},
        {13, 84, 0},{13, 86, 0},{13, 89, 0},{13, 92, 0},{13, 95, 0},{13, 99, 0},
        {13, 102, 0},{13, 105, 0},{13, 108, 0},{16, 42, 0},{16, 55, 0},{16, 64, 0},
        {16, 86, 0},{16, 95, 0},{16, 108, 0},{19, 42, 0},{19, 45, 0},{19, 48, 0},
        {19, 52, 0},{19, 55, 0},{19, 64, 0},{19, 69, 0},{19, 81, 0},{19, 86, 0},
        {19, 95, 0},{19, 98, 0},{19, 102, 0},{19, 105, 0},{19, 108, 0},{22, 55, 0},
        {22, 69, 0},{22, 81, 0},{22, 95, 0},{25, 55, 0},{25, 64, 0},{25, 67, 0},
        {25, 70, 0},{25, 73, 0},{25, 77, 0},{25, 80, 0},{25, 83, 0},{25, 86, 0},
        {25, 95, 0},{28, 55, 0},{28, 64, 0},{28, 86, 0},{28, 95, 0},{30, 55, 0},
        {30, 58, 0},{30, 61, 0},{30, 64, 0},{30, 86, 0},{30, 89, 0},{30, 92, 0},
        {30, 95, 0},{32, 55, 0},{32, 64, 0},{32, 86, 0},{32, 95, 0},{35, 55, 0},
        {35, 64, 0},{35, 67, 0},{35, 70, 0},{35, 73, 0},{35, 77, 0},{35, 80, 0},
        {35, 83, 0},{35, 86, 0},{35, 95, 0},{39, 42, 0},{39, 45, 0},{39, 48, 0},
        {39, 51, 0},{39, 55, 0},{39, 58, 0},{39, 61, 0},{39, 64, 0},{39, 67, 0},
        {39, 70, 0},{39, 80, 0},{39, 83, 0},{39, 86, 0},{39, 89, 0},{39, 92, 0},
        {39, 95, 0},{39, 99, 0},{39, 102, 0},{39, 105, 0},{39, 108, 0},{42, 42, 0},
        {42, 55, 0},{42, 70, 0},{42, 80, 0},{42, 95, 0},{42, 108, 0},{45, 42, 0},
        {45, 45, 0},{45, 49, 0},{45, 55, 0},{45, 58, 0},{45, 61, 0},{45, 64, 0},
        {45, 67, 0},{45, 70, 0},{45, 73, 0},{45, 77, 0},{45, 80, 0},{45, 83, 0},
        {45, 86, 0},{45, 89, 0},{45, 92, 0},{45, 95, 0},{45, 101, 0},{45, 105, 0},
        {45, 108, 0},{48, 49, 0},{48, 55, 0},{48, 64, 0},{48, 86, 0},{48, 95, 0},
        {48, 101, 0},{51, 42, 0},{51, 45, 0},{51, 48, 0},{51, 52, 0},{51, 55, 0},
        {51, 64, 0},{51, 67, 0},{51, 70, 0},{51, 80, 0},{51, 83, 0},{51, 86, 0},
        {51, 95, 0},{51, 98, 0},{51, 102, 0},{51, 105, 0},{51, 108, 0},{53, 42, 0},
        {53, 70, 0},{53, 80, 0},{53, 108, 0},{55, 42, 0},{55, 45, 0},{55, 48, 0},
        {55, 51, 0},{55, 54, 0},{55, 57, 0},{55, 60, 0},{55, 63, 0},{55, 66, 0},
        {55, 69, 0},{55, 72, 0},{55, 75, 0},{55, 78, 0},{55, 81, 0},{55, 84, 0},
        {55, 87, 0},{55, 90, 0},{55, 93, 0},{55, 96, 0},{55, 99, 0},{55, 102, 0},
        {55, 105, 0},{55, 108, 0}
};

//campo
const static char Campo[60][152]={"##==================================================================================================================================================##\n",
                       "||                                                                                                                                                  ||\n",
                       "||                                      #######################################################################                                     ||\n",
                       "||                                      #                              #########                              #                                     ||\n",
                       "||                                      # .  .  .  .   .  .  .  . .  . ######### .  . .  .  .  .   .  .  .  . #                                     ||\n",
                       "||         LEVEL:                       #                              #########                              #             LIVEs:                  ||\n",
                       "||         SCORE:                       #   ##########   ###########   #########   ###########   ##########   #             TIME:                   ||\n",
                       "||                                      # . ########## . ########### . ######### . ########### . ########## . #             FRUITs:                 ||\n",
                       "||                                      #   ##########   ###########   #########   ###########   ##########   #             KILLs:                  ||\n",
                       "||                                      #   ##########   ###########   #########   ###########   ##########   #                                     ||\n",
                       "||         HIGHSCORES:                  # . ########## . ########### . ######### . ########### . ########## . #                                     ||\n",
                       "||         1.                           #   ##########   ###########   #########   ###########   ##########   #                                     ||\n",
                       "||         2.                           #                                                                     #                                     ||\n",
                       "||         3.                           # .  .  .  .   .  .  .  . .  .  .  .  .  .  . .  .  .  .   .  .  .  . #                                     ||\n",
                       "||                                      #                                                                     #                                     ||\n",
                       "||                                      #   ##########   ######   ###################   ######   ##########   #                                     ||\n",
                       "||                                      # . ########## . ###### . ################### . ###### . ########## . #                                     ||\n",
                       "||                                      #   ##########   ######   ###################   ######   ##########   #                                     ||\n",
                       "||                                      #                ######        #########        ######  #                                     ||\n",
                       "||                                      # .  .  .   .  . ###### .    . ######### .    . ###### .  .   .  .  . #                                     ||\n",
                       "||                                      #                ######        #########        ######                #                                     ||\n",
                       "||                                      ##############   ###########   #########   ###########   ##############                                     ||\n",
                       "||                                      ############## . ########### . ######### . ########### . ##############                                     ||\n",
                       "||                                      ##############   ###########   #########   ###########   ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ############## . ###### .  .  .  .   .  .  .  . ###### . ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ##############   ######   #######+   +#######   ######   ##############                                     ||\n",
                       "||                                      ############## . ###### . #                 # . ###### . ##############                                     ||\n",
                       "||                                                                +                 +                                                               ||\n",
                       "||                                                     .  .  .  .                     .  .  .  .                                                    ||\n",
                       "||                                                                +                 +                                                               ||\n",
                       "||                                      ############## . ###### . #                 # . ###### . ##############                                     ||\n",
                       "||                                      ##############   ######   #######+   +#######   ######   ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ############## . ###### .  .  .  .   .  .  .  . ###### . ##############                                     ||\n",
                       "||                                      ##############   ######                         ######   ##############                                     ||\n",
                       "||                                      ##############   ######   ###################   ######   ##############                                     ||\n",
                       "||                                      #                               #######                               #                                     ||\n",
                       "||                                      # .  .  .  .   .  .  .  .  .  . ####### .  .  .  .  .  .   .  .  .  . #                                     ||\n",
                       "||                                      #                               #######                               #                                     ||\n",
                       "||                                      #   ##########   ############   #######   ############   ##########   #                                     ||\n",
                       "||                                      # . ########## . ############ . ####### . ############ . ########## . #                                     ||\n",
                       "||                                      #   ##########   ############   #######   ############   ##########   #                                     ||\n",
                       "||                                      #          ###                                           ###          #                                     ||\n",
                       "||                                      # .  .   . ### .  .  .  .  .  .  .   .  .  .  .  .  .  . ### .   .  . #                                     ||\n",
                       "||                                      #          ###                                           ###          #                                     ||\n",
                       "||                                      ########   ###   ######   ###################   ######   ###   ########                                     ||\n",
                       "||                                      ######## . ### . ###### . ################### . ###### . ### . ########                                     ||\n",
                       "||                                      ########   ###   ######   ###################   ######   ###   ########                                     ||\n",
                       "||                                      #                ######         #######         ######                #                                     ||\n",
                       "||                                      # .  .  .   .  . ###### .  .  . ####### .  .  . ###### .  .   .  .  . #                                     ||\n",
                       "||                                      #                ######         #######         ######                #                                     ||\n",
                       "||                                      # . ######################### . ####### . ######################### . #                                     ||\n",
                       "||                                      #                                                                     #                                     ||\n",
                       "||                                      # .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . #                                     ||\n",
                       "||                                      #                                                                     #                                     ||\n",
                       "||                                      #######################################################################                                     ||\n",
                       "||                                                                                                                                                  ||\n",
                       "##==================================================================================================================================================##"
};

const static char scampo[60][152] = {
                                    "##==================================================================================================================================================##\n",
                                    "||                                                                                                                                                  ||\n",
                                    "||                                      #######################################################################                                     ||\n",
                                    "||                                      #                              #########                              #                                     ||\n",
                                    "||                                      # .  .  .  .   .  .  .  . .  . ######### .  . .  .  .  .   .  .  .  . #                                     ||\n",
                                    "||         LEVEL:                       #                              #########                              #             LIVEs:                  ||\n",
                                    "||         SCORE:                       #   ##########   ###########   #########   ###########   ##########   #             TIME:                   ||\n",
                                    "||                                      # . ########## . ########### . ######### . ########### . ########## . #             FRUITs:                 ||\n",
                                    "||                                      #   ##########   ###########   #########   ###########   ##########   #             KILLs:                  ||\n",
                                    "||                                      #   ##########   ###########   #########   ###########   ##########   #                                     ||\n",
                                    "||         HIGHSCORES:                  # . ########## . ########### . ######### . ########### . ########## . #                                     ||\n",
                                    "||         1.                           #   ##########   ###########   #########   ###########   ##########   #                                     ||\n",
                                    "||         2.                           #                                                                     #                                     ||\n",
                                    "||         3.                           # .  .  .  .   .  .  .  . .  .  .  .  .  .  . .  .  .  .   .  .  .  . #                                     ||\n",
                                    "||                                      #                                                                     #                                     ||\n",
                                    "||                                      #   ##########   ######   ###################   ######   ##########   #                                     ||\n",
                                    "||                                      # . ########## . ###### . ################### . ###### . ########## . #                                     ||\n",
                                    "||                                      #   ##########   ######   ###################   ######   ##########   #                                     ||\n",
                                    "||                                      #                ######        #########        ######                #                                     ||\n",
                                    "||                                      # .  .  .   .  . ###### .    . ######### .    . ###### .  .   .  .  . #                                     ||\n",
                                    "||                                      #                ######        #########        ######                #                                     ||\n",
                                    "||                                      ##############   ###########   #########   ###########   ##############                                     ||\n",
                                    "||                                      ############## . ########### . ######### . ########### . ##############                                     ||\n",
                                    "||                                      ##############   ###########   #########   ###########   ##############                                     ||\n",
                                    "||                                      ##############   ######                         ######   ##############                                     ||\n",
                                    "||                                      ############## . ###### .  .  .  .   .  .  .  . ###### . ##############                                     ||\n",
                                    "||                                      ##############   ######                         ######   ##############                                     ||\n",
                                    "||                                      ##############   ######   #######+ # +#######   ######   ##############                                     ||\n",
                                    "||                                      ############## . ###### . #                 # . ###### . ##############                                     ||\n",
                                    "||                                   #                            +                 +                            #                                  ||\n",
                                    "||                                   #                 .  .  .  . #                 # .  .  .  .                 #                                  ||\n",
                                    "||                                   #                            +                 +                            #                                  ||\n",
                                    "||                                      ############## . ###### . #                 # . ###### . ##############                                     ||\n",
                                    "||                                      ##############   ######   #######+ # +#######   ######   ##############                                     ||\n",
                                    "||                                      ##############   ######                         ######   ##############                                     ||\n",
                                    "||                                      ############## . ###### .  .  .  .   .  .  .  . ###### . ##############                                     ||\n",
                                    "||                                      ##############   ######                         ######   ##############                                     ||\n",
                                    "||                                      ##############   ######   ###################   ######   ##############                                     ||\n",
                                    "||                                      #                               #######                               #                                     ||\n",
                                    "||                                      # .  .  .  .   .  .  .  .  .  . ####### .  .  .  .  .  .   .  .  .  . #                                     ||\n",
                                    "||                                      #                               #######                               #                                     ||\n",
                                    "||                                      #   ##########   ############   #######   ############   ##########   #                                     ||\n",
                                    "||                                      # . ########## . ############ . ####### . ############ . ########## . #                                     ||\n",
                                    "||                                      #   ##########   ############   #######   ############   ##########   #                                     ||\n",
                                    "||                                      #          ###                                           ###          #                                     ||\n",
                                    "||                                      # .  .   . ### .  .  .  .  .  .  .   .  .  .  .  .  .  . ### .   .  . #                                     ||\n",
                                    "||                                      #          ###                                           ###          #                                     ||\n",
                                    "||                                      ########   ###   ######   ###################   ######   ###   ########                                     ||\n",
                                    "||                                      ######## . ### . ###### . ################### . ###### . ### . ########                                     ||\n",
                                    "||                                      ########   ###   ######   ###################   ######   ###   ########                                     ||\n",
                                    "||                                      #                ######         #######         ######                #                                     ||\n",
                                    "||                                      # .  .  .   .  . ###### .  .  . ####### .  .  . ###### .  .   .  .  . #                                     ||\n",
                                    "||                                      #                ######         #######         ######                #                                     ||\n",
                                    "||                                      # . ######################### . ####### . ######################### . #                                     ||\n",
                                    "||                                      #                                                                     #                                     ||\n",
                                    "||                                      # .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . #                                     ||\n",
                                    "||                                      #                                                                     #                                     ||\n",
                                    "||                                      #######################################################################                                     ||\n",
                                    "||                                                                                                                                                  ||\n",
                                    "##==================================================================================================================================================##"
};

#endif